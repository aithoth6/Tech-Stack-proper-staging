<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<base target="_top">
<title>Menu Manager - Severina Plus</title>
<style>
  :root { --primary: #667eea; --secondary: #764ba2; --success: #10b981; --danger: #ef4444; }
  body { font-family: -apple-system, sans-serif; background: #f3f4f6; margin: 0; padding: 15px; }
  .container { max-width: 800px; margin: 0 auto; }
  
  .header { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 15px; }
  .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; gap: 10px; }
  
  /* Styling for the new Back Button */
  .back-btn { 
    background: #f3f4f6; 
    border: none; 
    padding: 10px 15px; 
    border-radius: 10px; 
    cursor: pointer; 
    font-size: 18px;
    transition: 0.2s;
  }
  .back-btn:hover { background: #e5e7eb; }

  .staff-select { padding: 10px; border-radius: 8px; border: 2px solid #e5e7eb; width: 100%; max-width: 180px; }
  .search-box { width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #e5e7eb; margin-bottom: 10px; font-size: 16px; box-sizing: border-box; }
  
  .item-card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
  .item-info { flex-grow: 1; }
  .item-name { font-weight: bold; font-size: 16px; color: #1f2937; }
  .item-cat { font-size: 12px; color: #6b7280; text-transform: uppercase; margin-top: 2px; }
  
  .status-btn { padding: 10px 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; min-width: 120px; }
  .available { background: #dcfce7; color: #166534; border: 1px solid #166534; }
  .out-of-stock { background: #fee2e2; color: #991b1b; border: 1px solid #991b1b; }
  .loading-overlay { text-align: center; padding: 50px; color: #667eea; font-weight: bold; }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="header-top">
      <div style="display: flex; align-items: center; gap: 10px;">
        <button class="back-btn" onclick="backToKitchen()">‚¨ÖÔ∏è</button>
        <h2 style="margin:0; font-size: 20px;">Menu Manager</h2>
      </div>
      <select id="staffSelect" class="staff-select">
        <option value="">üë§ Staff</option>
        <option value="Eliklim">Eliklim</option>
        <option value="Nii">Nii</option>
        <option value="Norah">Norah</option>
        <option value="Mansah">Mansah</option>
        <option value="Mawusi">Mawusi</option>
        <option value="Portia">Portia</option>
        <option value="Tsoekem">Tsoekem</option>
        <option value="Bridget">Bridget</option>
        <option value="Setornam">Setornam</option>
      </select>
    </div>
    <input type="text" id="searchBox" class="search-box" placeholder="üîç Search menu items..." oninput="renderMenu()">
  </div>

  <div id="loading" class="loading-overlay">‚è≥ Fetching menu status...</div>
  <div id="menuContainer"></div>
</div>

<script>
const SCRIPT_URL = "<?= scriptUrl ?>";
const IS_DEV = JSON.parse("<?= isDev ?>");
let menuData = [];

// Function to return to Kitchen
// Inside menu_manager.html
function backToKitchen() {
    var a = document.createElement('a');
    a.href = SCRIPT_URL; // Uses the dynamic SCRIPT_URL
    a.target = '_top'; 
    document.body.appendChild(a);
    a.click();
}

// Update the Menu Manager page similarly (menu_manager.html)
async function loadMenu() {
    google.script.run
      .withSuccessHandler(function(data) {
          if (data.success) {
              menuData = data.items;
              document.getElementById('loading').style.display = 'none';
              renderMenu();
          }
      })
      .getMenuStatus();
}
function renderMenu() {
  const query = document.getElementById('searchBox').value.toLowerCase();
  const container = document.getElementById('menuContainer');
  const filtered = menuData.filter(item => 
    item.itemName.toLowerCase().includes(query) || 
    item.category.toLowerCase().includes(query)
  );

  container.innerHTML = filtered.map(item => `
    <div class="item-card">
      <div class="item-info">
        <div class="item-name">${item.itemName}</div>
        <div class="item-cat">${item.category}</div>
      </div>
      <button class="status-btn ${item.status === 'Available' ? 'available' : 'out-of-stock'}" 
              onclick="toggleStatus('${item.itemName.replace(/'/g, "\\'")}', '${item.status}')">
        ${item.status === 'Available' ? '‚úÖ Available' : '‚ùå Out of Stock'}
      </button>
    </div>
  `).join('');
}

// Add 'async' here so we can wait for the custom alert
async function toggleStatus(name, currentStatus) {
  const staff = document.getElementById('staffSelect').value;
  
  if (!staff) {
    // Replace alert() with your clean custom alert
    await showCustomAlert("‚ö†Ô∏è Please select your name first!");
    document.getElementById('staffSelect').focus();
    return;
  }
  
  const newStatus = currentStatus === 'Available' ? 'Out of Stock' : 'Available';
  
  google.script.run
    .withSuccessHandler(function(result) {
      if (result.success) {
        loadMenu(); 
      } else {
        // You can also use showCustomAlert here for errors
        showCustomAlert("Update failed: " + result.error);
      }
    })
    .updateMenuStatus(name, newStatus, staff);
}
window.onload = loadMenu;
function showCustomAlert(message) {
    return new Promise((resolve) => {
        const modal = document.createElement('div');
        modal.style = "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:10000;";
        
        modal.innerHTML = `
            <div style="background:white;padding:25px;border-radius:12px;text-align:center;width:320px;box-shadow:0 10px 25px rgba(0,0,0,0.2);font-family: Arial, sans-serif;">
                <h3 style="margin:0 0 15px; color:#d9534f;">‚ö†Ô∏è Action Required</h3>
                <p style="margin-bottom:25px;color:#666;line-height:1.4;">${message}</p>
                <button id="alert-ok" style="padding:10px 30px;border:none;border-radius:6px;background:#333;color:white;cursor:pointer;font-weight:bold;width:100%;">OK</button>
            </div>
        `;
        
        document.body.appendChild(modal);
        document.getElementById('alert-ok').onclick = () => { modal.remove(); resolve(); };
    });
}
</script>
</body>
</html>